<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor Visual Avançado (GrapesJS) - LP de Indicadores</title>
  <link rel="stylesheet" href="https://unpkg.com/grapesjs/dist/css/grapes.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    body { 
      background: #f5f6fa; 
      margin: 0; 
      padding: 15px; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .editor-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 15px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .editor-header h1 { 
      font-size: 1.4rem; 
      margin: 0; 
      color: #2c3e50;
      font-weight: 600;
    }
    .editor-header .actions { display: flex; gap: 12px; align-items: center; }
    .btn { 
      padding: 10px 20px; 
      border-radius: 6px; 
      border: none; 
      font-weight: 500; 
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    .btn-primary { 
      background: #3498db; 
      color: #fff; 
    }
    .btn-primary:hover {
      background: #2980b9;
    }
    .btn-secondary { 
      background: #95a5a6; 
      color: #fff; 
    }
    .btn-secondary:hover {
      background: #7f8c8d;
    }
    
    .editor-row { 
      display: flex; 
      gap: 15px;
      height: calc(100vh - 140px);
    }
    .editor-canvas { 
      flex: 1;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    #gjs { 
      height: 100%;
      border: none;
    }
    
    .panel__right { 
      width: 320px; 
      background: #fff; 
      border-radius: 8px; 
      padding: 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .panel__devices { 
      padding: 12px 15px;
      border-bottom: 1px solid #ecf0f1;
      background: #f8f9fa;
      flex-shrink: 0;
    }
    
    /* Sistema de Abas */
    .panel__tabs {
      display: flex;
      background: #fff;
      border-bottom: 2px solid #ecf0f1;
      flex-shrink: 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .panel__tab {
      flex: 1;
      padding: 15px 8px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 11px;
      font-weight: 700;
      color: #95a5a6;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
      position: relative;
      min-height: 70px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .panel__tab:hover {
      background: #f8f9fa;
      color: #2c3e50;
      transform: translateY(-1px);
    }
    
    .panel__tab.active {
      color: #3498db;
      background: #fff;
      border-bottom-color: #3498db;
      box-shadow: 0 -2px 8px rgba(52, 152, 219, 0.1);
    }
    
    /* Destaque especial para a aba de blocos quando ativa */
    .panel__tab[data-tab="blocks"].active {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      color: #2c3e50;
      border-bottom-color: #27ae60;
    }
    
    .panel__tab[data-tab="blocks"].active::before {
      background: #27ae60;
    }
    
    .panel__tab i {
      display: block;
      font-size: 18px;
      margin-bottom: 2px;
    }
    
    .panel__tab span {
      font-size: 10px;
      font-weight: 600;
    }
    
    /* Conteúdo das Abas */
    .panel__content {
      flex: 1;
      overflow: hidden;
      position: relative;
    }
    
    .panel__tab-content {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .panel__tab-content.active {
      opacity: 1;
      visibility: visible;
    }
    
    /* Estilos específicos para cada aba */
    .blocks-container, 
    .styles-container, 
    .traits-container { 
      border: none;
      flex: none;
      overflow: visible;
      height: 100%;
      padding: 15px;
    }
    
    .blocks-container h3,
    .styles-container h3,
    .traits-container h3 {
      display: none; /* Removemos os títulos já que temos abas */
    }
    
    /* Customização específica dos blocos */
    .gjs-blocks-c {
      padding: 0 !important;
    }
    
    .gjs-block {
      width: 100% !important;
      height: auto !important;
      min-height: 44px !important;
      margin: 0 0 8px 0 !important;
      padding: 12px 15px !important;
      background: #ffffff !important;
      border: 1px solid #ecf0f1 !important;
      border-radius: 6px !important;
      cursor: grab !important;
      transition: all 0.2s ease !important;
      display: flex !important;
      align-items: center !important;
      font-size: 13px !important;
      color: #2c3e50 !important;
      font-weight: 500 !important;
      justify-content: space-between !important;
    }
    
    .gjs-block:hover {
      background: #f8f9fa !important;
      border-color: #3498db !important;
      transform: translateX(2px) !important;
      box-shadow: 0 2px 8px rgba(52, 152, 219, 0.15) !important;
    }
    
    .gjs-block:active {
      cursor: grabbing !important;
    }
    
    /* Melhorar ícones dos blocos */
    .gjs-block::before {
      content: "⋮⋮";
      color: #bdc3c7;
      font-weight: bold;
      margin-left: auto;
      font-size: 14px;
    }
    
    /* Ajustar painéis internos do GrapesJS */
    .gjs-sm-sector {
      border: none !important;
      margin-bottom: 12px !important;
      border-radius: 6px !important;
      overflow: hidden !important;
      background: #fff !important;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
    }
    
    .gjs-sm-title {
      background: #f8f9fa !important;
      padding: 10px 15px !important;
      font-size: 12px !important;
      font-weight: 600 !important;
      color: #495057 !important;
      border-bottom: 1px solid #ecf0f1 !important;
      cursor: pointer !important;
      transition: background 0.2s ease !important;
    }
    
    .gjs-sm-title:hover {
      background: #e9ecef !important;
    }
    
    .gjs-sm-properties {
      padding: 15px !important;
      background: #fff !important;
    }
    
    .gjs-field {
      margin-bottom: 12px !important;
    }
    
    .gjs-field input,
    .gjs-field select {
      width: 100% !important;
      padding: 8px 12px !important;
      border: 1px solid #ddd !important;
      border-radius: 4px !important;
      font-size: 13px !important;
    }
    
    .gjs-field input:focus,
    .gjs-field select:focus {
      border-color: #3498db !important;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1) !important;
      outline: none !important;
    }
    
    /* Botões dos dispositivos */
    .gjs-pn-btn {
      background: #ecf0f1 !important;
      border: none !important;
      padding: 8px 12px !important;
      margin-right: 8px !important;
      border-radius: 4px !important;
      color: #7f8c8d !important;
      font-size: 13px !important;
      transition: all 0.2s ease !important;
    }
    
    .gjs-pn-btn.gjs-pn-active {
      background: #3498db !important;
      color: #fff !important;
    }
    
    .gjs-pn-btn:hover {
      background: #d5dbdb !important;
      transform: translateY(-1px) !important;
    }
    
    .gjs-pn-btn.gjs-pn-active:hover {
      background: #2980b9 !important;
    }
    
    /* Melhorar traits/propriedades */
    .gjs-trt-trait {
      margin-bottom: 12px !important;
    }
    
    .gjs-trt-trait__label {
      color: #495057 !important;
      font-weight: 500 !important;
      font-size: 12px !important;
      margin-bottom: 6px !important;
      display: block !important;
    }
    
    /* Melhorar aparência do canvas */
    .gjs-cv-canvas {
      background: #ffffff !important;
    }
    
    /* Melhorar contraste dos textos no painel de estilos */
    .gjs-sm-label {
      color: #2c3e50 !important;
      font-weight: 500 !important;
      font-size: 12px !important;
    }
    
    .gjs-sm-property {
      background: #ffffff !important;
      border: 1px solid #e9ecef !important;
      border-radius: 4px !important;
      margin-bottom: 8px !important;
    }
    
    .gjs-sm-property .gjs-field {
      background: #ffffff !important;
    }
    
    .gjs-sm-property .gjs-field input,
    .gjs-sm-property .gjs-field select,
    .gjs-sm-property .gjs-field-color input {
      color: #2c3e50 !important;
      background: #ffffff !important;
      border: 1px solid #dee2e6 !important;
      font-size: 12px !important;
    }
    
    .gjs-sm-property .gjs-field input:focus,
    .gjs-sm-property .gjs-field select:focus {
      border-color: #3498db !important;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1) !important;
    }
    
    /* Estilos específicos para labels no style manager */
    .gjs-sm-label-title {
      color: #2c3e50 !important;
      font-weight: 600 !important;
      font-size: 11px !important;
      text-transform: uppercase !important;
      letter-spacing: 0.5px !important;
    }
    
    /* Melhorar inputs numéricos e de texto */
    .gjs-sm-property input[type="text"],
    .gjs-sm-property input[type="number"],
    .gjs-sm-property select {
      color: #2c3e50 !important;
      background: #ffffff !important;
      border: 1px solid #ced4da !important;
      padding: 6px 10px !important;
      border-radius: 3px !important;
    }
    
    /* Melhorar dropdown de propriedades */
    .gjs-sm-property select option {
      color: #2c3e50 !important;
      background: #ffffff !important;
    }
    
    /* Melhorar botões de unidade */
    .gjs-sm-unit {
      color: #6c757d !important;
      background: #f8f9fa !important;
      border: 1px solid #ced4da !important;
      font-size: 11px !important;
    }
    
    .gjs-sm-unit:hover {
      color: #2c3e50 !important;
      background: #e9ecef !important;
    }
    
    /* Melhorar seletor de classes */
    .gjs-clm-tag {
      background: #f8f9fa !important;
      color: #495057 !important;
      border: 1px solid #dee2e6 !important;
      border-radius: 3px !important;
      padding: 4px 8px !important;
      margin: 2px !important;
      font-size: 11px !important;
    }
    
    .gjs-clm-tag:hover {
      background: #e9ecef !important;
      color: #2c3e50 !important;
    }
    
    .gjs-clm-tag.gjs-clm-tag--active {
      background: #3498db !important;
      color: #ffffff !important;
      border-color: #3498db !important;
    }
    
    /* Forçar cor de texto escura em elementos do style manager */
    .gjs-sm-properties *,
    .gjs-sm-sector * {
      color: #2c3e50 !important;
    }
    
    /* Melhorar scrollbar do painel de estilos */
    .gjs-sm-sectors::-webkit-scrollbar {
      width: 6px;
    }
    
    .gjs-sm-sectors::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    .gjs-sm-sectors::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }
    
    .gjs-sm-sectors::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    
    /* Estilos adicionais para melhorar contraste */
    .gjs-sm-property-label,
    .gjs-sm-property .gjs-sm-label {
      color: #2c3e50 !important;
      font-weight: 500 !important;
      background: transparent !important;
    }
    
    /* Melhorar campos de entrada específicos */
    .gjs-sm-property input[type="range"] {
      background: #f8f9fa !important;
    }
    
    .gjs-sm-property input[type="range"]::-webkit-slider-thumb {
      background: #3498db !important;
    }
    
    /* Melhorar campos de cores */
    .gjs-sm-property .gjs-field-color-picker {
      background: #ffffff !important;
      border: 1px solid #ced4da !important;
    }
    
    /* Melhorar seletores */
    .gjs-sm-property .gjs-field-select select {
      color: #2c3e50 !important;
      background: #ffffff !important;
      border: 1px solid #ced4da !important;
    }
    
    /* Melhorar checkboxes e radio buttons */
    .gjs-sm-property input[type="checkbox"],
    .gjs-sm-property input[type="radio"] {
      accent-color: #3498db !important;
    }
    
    /* Melhorar textos de help/hint */
    .gjs-sm-property .gjs-sm-hint {
      color: #6c757d !important;
      font-size: 11px !important;
    }
    
    /* Forçar cor escura em todos os elementos de texto */
    .styles-container *,
    .gjs-sm-sector *,
    .gjs-sm-properties *,
    .gjs-sm-property * {
      color: #2c3e50 !important;
    }
    
    /* Exceções para manter cores funcionais */
    .gjs-field-color input[type="color"],
    .gjs-field-color-picker,
    .gjs-field-color .gjs-color-value {
      color: initial !important;
    }
    
    /* Regra final para máximo contraste no style manager */
    #tab-styles *:not(input[type="color"]):not(.gjs-field-color-picker) {
      color: #2c3e50 !important;
    }
    
    /* Forçar fundo branco nos campos de entrada */
    #tab-styles input:not([type="color"]),
    #tab-styles select,
    #tab-styles textarea {
      background: #ffffff !important;
      color: #2c3e50 !important;
      border: 1px solid #ced4da !important;
    }
    
    /* Melhorar botões específicos */
    #tab-styles button {
      background: #f8f9fa !important;
      color: #2c3e50 !important;
      border: 1px solid #ced4da !important;
    }
    
    #tab-styles button:hover {
      background: #3498db !important;
      color: #ffffff !important;
    }
    
    /* Indicadores de conteúdo nas abas */
    .panel__tab.has-content::after {
      content: "";
      position: absolute;
      top: 6px;
      right: 8px;
      width: 8px;
      height: 8px;
      background: #27ae60;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    
    /* Indicador de aba ativa mais proeminente */
    .panel__tab.active::before {
      content: "";
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 3px;
      background: #3498db;
      border-radius: 0 0 3px 3px;
    }
    
    /* Melhorar seleção de elementos no canvas */
    .gjs-selected {
      box-shadow: 0 0 0 2px #3498db !important;
    }
    
    /* Scrollbar customizada */
    .panel__tab-content::-webkit-scrollbar {
      width: 6px;
    }
    
    .panel__tab-content::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    .panel__tab-content::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }
    
    .panel__tab-content::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    
    /* Estado vazio das abas */
    .panel__tab-content.empty::before {
      content: "Clique em um elemento no canvas para editá-lo";
      display: block;
      text-align: center;
      color: #7f8c8d;
      font-size: 13px;
      padding: 40px 20px;
      font-style: italic;
    }
    
    #tab-styles.empty::before {
      content: "Selecione um elemento para editar seus estilos";
    }
    
    #tab-traits.empty::before {
      content: "Selecione um elemento para ver suas propriedades";
    }
    
    /* Controles de dispositivo no header */
    .device-controls {
      display: flex;
      gap: 4px;
      margin-right: 15px;
      padding: 4px;
      background: #ecf0f1;
      border-radius: 6px;
    }
    
    .btn-device {
      padding: 8px 12px !important;
      background: transparent !important;
      color: #7f8c8d !important;
      border: none !important;
      border-radius: 4px !important;
      font-size: 14px !important;
      transition: all 0.2s ease !important;
    }
    
    .btn-device:hover {
      background: #d5dbdb !important;
      color: #2c3e50 !important;
    }
    
    .btn-device.active {
      background: #3498db !important;
      color: #fff !important;
    }
    
    /* Botão toggle do painel */
    .panel__toggle {
      padding: 12px 15px;
      border-bottom: 1px solid #ecf0f1;
      background: #f8f9fa;
      flex-shrink: 0;
    }
    
    .panel__toggle-btn {
      width: 100%;
      padding: 12px 15px;
      background: #fff;
      border: 1px solid #ecf0f1;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: #2c3e50;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }
    
    .panel__toggle-btn:hover {
      background: #3498db;
      color: #fff;
      border-color: #3498db;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(52, 152, 219, 0.2);
    }
    
    .panel__toggle-btn i {
      font-size: 14px;
    }
    
    /* Estados do painel lateral */
    .panel__right.collapsed {
      width: 60px !important;
    }
    
    .panel__right.collapsed .panel__tabs,
    .panel__right.collapsed .panel__content {
      display: none;
    }
    
    .panel__right.collapsed .panel__toggle-btn span {
      display: none;
    }
    
    .panel__right.collapsed .panel__toggle-btn {
      padding: 12px;
      justify-content: center;
    }
    
    /* Transições suaves */
    .panel__right {
      transition: width 0.3s ease;
    }
    
    .panel__toggle-btn span {
      transition: opacity 0.2s ease;
    }
    
    /* Melhorar visualização dos setores do Style Manager */
    .gjs-sm-sector.gjs-sm-open {
      background: #f8f9fa !important;
      border-left: 3px solid #3498db !important;
    }
    
    .gjs-sm-sector.gjs-sm-open .gjs-sm-title {
      background: #e3f2fd !important;
      color: #1976d2 !important;
      font-weight: 700 !important;
    }
    
    /* Melhorar indicadores visuais de setores ativos */
    .gjs-sm-sector .gjs-sm-title::before {
      content: "▶";
      margin-right: 8px;
      transition: transform 0.3s ease;
      color: #7f8c8d;
    }
    
    .gjs-sm-sector.gjs-sm-open .gjs-sm-title::before {
      transform: rotate(90deg);
      color: #1976d2;
    }
    
    /* Melhorar campos específicos por tipo */
    .gjs-sm-property[data-property="font-size"] input,
    .gjs-sm-property[data-property="line-height"] input,
    .gjs-sm-property[data-property="letter-spacing"] input {
      background: #fff3e0 !important;
      border-left: 3px solid #ff9800 !important;
    }
    
    .gjs-sm-property[data-property*="background"] input,
    .gjs-sm-property[data-property*="background"] select {
      background: #f3e5f5 !important;
      border-left: 3px solid #9c27b0 !important;
    }
    
    .gjs-sm-property[data-property*="color"] input {
      background: #e8f5e8 !important;
      border-left: 3px solid #4caf50 !important;
    }
    
    /* Melhorar feedback visual para propriedades importantes */
    .gjs-sm-property[data-property="display"],
    .gjs-sm-property[data-property="position"],
    .gjs-sm-property[data-property="width"],
    .gjs-sm-property[data-property="height"] {
      background: #fff9c4 !important;
      border-left: 3px solid #ffc107 !important;
    }
    
    /* Destaque para propriedades modificadas */
    .gjs-sm-property.gjs-sm-modified {
      background: #e8f5e8 !important;
      border: 1px solid #4caf50 !important;
      box-shadow: 0 2px 4px rgba(76, 175, 80, 0.1) !important;
    }
    
    .gjs-sm-property.gjs-sm-modified .gjs-sm-label {
      color: #2e7d32 !important;
      font-weight: 700 !important;
    }
    
    /* Estilos específicos para os setores essenciais */
    .gjs-sm-sector[data-sector="📦 Container & Espaçamento"] {
      border-left: 4px solid #2196f3 !important;
    }
    
    .gjs-sm-sector[data-sector="🖼️ Fundo & Cores"] {
      border-left: 4px solid #9c27b0 !important;
    }
    
    .gjs-sm-sector[data-sector="✏️ Fontes & Tipografia"] {
      border-left: 4px solid #ff9800 !important;
    }
    
    /* Melhorar aparência do bloco espaçador */
    .spacer-block {
      transition: all 0.3s ease !important;
      cursor: pointer !important;
    }
    
    .spacer-block:hover {
      background: #f5f5f5 !important;
      border-color: #3498db !important;
      color: #3498db !important;
    }
    
    /* Destacar propriedades essenciais */
    .gjs-sm-property[data-property="background-color"],
    .gjs-sm-property[data-property="background-image"] {
      background: #f3e5f5 !important;
      border-left: 4px solid #9c27b0 !important;
    }
    
    .gjs-sm-property[data-property="font-family"],
    .gjs-sm-property[data-property="font-size"],
    .gjs-sm-property[data-property="color"] {
      background: #fff3e0 !important;
      border-left: 4px solid #ff9800 !important;
    }
    
    .gjs-sm-property[data-property="padding"],
    .gjs-sm-property[data-property="margin"],
    .gjs-sm-property[data-property="width"],
    .gjs-sm-property[data-property="height"] {
      background: #e3f2fd !important;
      border-left: 4px solid #2196f3 !important;
    }
    
    /* Indicadores especiais para setores essenciais */
    .gjs-sm-sector[data-sector="📦 Container & Espaçamento"] .gjs-sm-title::after,
    .gjs-sm-sector[data-sector="🖼️ Fundo & Cores"] .gjs-sm-title::after,
    .gjs-sm-sector[data-sector="✏️ Fontes & Tipografia"] .gjs-sm-title::after {
      content: "⭐";
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #ffc107;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <script src="../js/auth.js"></script>
  <script>checkAuth();</script>
  <div class="editor-header">
    <h1>Editor Visual Avançado (GrapesJS) - LP de Indicadores</h1>
    <div class="actions">
      <div class="device-controls">
        <button class="btn btn-device active" data-device="desktop">
          <i class="fas fa-desktop"></i>
        </button>
        <button class="btn btn-device" data-device="mobile">
          <i class="fas fa-mobile"></i>
        </button>
      </div>
      <button class="btn btn-secondary" onclick="window.location.href='lp-indicadores.html'">Voltar</button>
      <button class="btn btn-primary" onclick="saveLP()">Salvar LP</button>
    </div>
  </div>
  <div style="margin: 20px 0 10px 0; text-align: left;">
    <label for="nomeLP" style="font-weight:600;">Nome da Landing Page:</label>
    <input id="nomeLP" type="text" value="LP de Indicadores" style="padding:8px; width: 320px; border-radius:4px; border:1px solid #ccc; margin-left:10px;">
  </div>
  
  <div class="editor-row">
    <div class="editor-canvas">
      <div id="gjs"></div>
    </div>
    <div class="panel__right">
      <!-- Botão toggle para mostrar/esconder painel -->
      <div class="panel__toggle">
        <button class="panel__toggle-btn" onclick="toggleSidebar()">
          <i class="fas fa-bars"></i>
          <span>Componentes</span>
        </button>
      </div>
      
      <div class="panel__tabs">
        <button class="panel__tab active" data-tab="blocks">
          <i class="fas fa-th-large"></i>
          <span>BLOCOS</span>
        </button>
        <button class="panel__tab" data-tab="styles">
          <i class="fas fa-paint-brush"></i>
          <span>ESTILOS</span>
        </button>
        <button class="panel__tab" data-tab="traits">
          <i class="fas fa-cogs"></i>
          <span>PROPS</span>
        </button>
      </div>
      
      <div class="panel__content">
        <div class="panel__tab-content active" id="tab-blocks">
          <div class="blocks-container">
            <div style="padding: 15px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; margin: -15px -15px 15px -15px;">
              <h4 style="margin: 0 0 5px 0; color: #2c3e50; font-size: 13px; font-weight: 600;">📦 Componentes Disponíveis</h4>
              <p style="margin: 0; color: #7f8c8d; font-size: 11px;">Arraste os blocos abaixo para o canvas para construir sua landing page</p>
            </div>
            <!-- Blocos serão inseridos aqui automaticamente -->
          </div>
        </div>
        
        <div class="panel__tab-content" id="tab-styles">
          <div class="styles-container">
            <div style="padding: 15px; background: #e3f2fd; border-bottom: 1px solid #bbdefb; margin: -15px -15px 15px -15px;">
              <h4 style="margin: 0 0 5px 0; color: #1976d2; font-size: 13px; font-weight: 600;">🎨 Editor de Estilos</h4>
              <p style="margin: 0; color: #1565c0; font-size: 11px;">Selecione um elemento no canvas e personalize suas propriedades visuais aqui</p>
            </div>
            <!-- Estilos serão inseridos aqui automaticamente -->
          </div>
        </div>
        
        <div class="panel__tab-content" id="tab-traits">
          <div class="traits-container">
            <!-- Propriedades serão inseridas aqui automaticamente -->
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/grapesjs"></script>
  <script>
    console.log('[GrapesJS Debug] Iniciando configuração do editor...');
    
    try {
      const editor = grapesjs.init({
        container: '#gjs',
        fromElement: false,
        height: '100%',
        width: 'auto',
        storageManager: false,
        showOffsets: true,
        noticeOnUnload: false,
        panels: { 
          defaults: [
            // Removemos o painel de devices do GrapesJS pois agora está no header
          ]
        },
        blockManager: {
          appendTo: '#tab-blocks .blocks-container'
        },
        selectorManager: {
          appendTo: '#tab-styles .styles-container'
        },
        styleManager: {
          appendTo: '#tab-styles .styles-container',
          sectors: [
            { 
              name: '📦 Container & Espaçamento', 
              open: true, 
              buildProps: [
                'width', 'height', 'max-width', 'min-height',
                'margin', 'margin-top', 'margin-right', 'margin-bottom', 'margin-left',
                'padding', 'padding-top', 'padding-right', 'padding-bottom', 'padding-left',
                'box-sizing'
              ]
            },
            { 
              name: '🖼️ Fundo & Cores', 
              open: true, 
              buildProps: [
                'background-color', 'background-image', 'background-size',
                'background-repeat', 'background-position', 'background-attachment',
                'background-blend-mode'
              ]
            },
            { 
              name: '✏️ Fontes & Tipografia', 
              open: true, 
              buildProps: [
                'font-family', 'font-size', 'font-weight', 'font-style',
                'line-height', 'letter-spacing', 'color',
                'text-align', 'text-decoration', 'text-transform'
              ]
            },
            { 
              name: '📐 Posicionamento', 
              open: false, 
              buildProps: [
                'position', 'top', 'right', 'bottom', 'left', 'z-index',
                'display', 'visibility', 'opacity'
              ]
            },
            { 
              name: '🔄 Layout Flexível', 
              open: false, 
              buildProps: [
                'flex-direction', 'justify-content', 'align-items', 'flex-wrap', 'gap',
                'align-content', 'flex-grow', 'flex-shrink'
              ]
            },
            { 
              name: '🔲 Bordas & Efeitos', 
              open: false, 
              buildProps: [
                'border', 'border-width', 'border-style', 'border-color',
                'border-radius', 'box-shadow', 'outline'
              ]
            },
            { 
              name: '✨ Transformações', 
              open: false, 
              buildProps: [
                'transform', 'transition', 'animation',
                'filter', 'overflow'
              ]
            }
          ]
        },
        traitManager: {
          appendTo: '#tab-traits .traits-container'
        },
        canvas: {
          styles: [
            'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css'
          ]
        },
        deviceManager: {
          devices: [
            {
              name: 'Desktop',
              width: '', // Default size
              widthMedia: '1024px'
            },
            {
              name: 'Mobile',
              width: '375px',
              widthMedia: '768px'
            }
          ]
        }
      });
      window.editor = editor;

      console.log('[GrapesJS Debug] Editor inicializado com sucesso:', editor);

      // Blocos básicos
      console.log('[GrapesJS Debug] Adicionando blocos...');
      
      editor.BlockManager.add('section', {
        label: 'Seção',
        content: `
          <section style="padding: 40px 20px; text-align: center;">
            <div style="max-width: 1200px; margin: 0 auto;">
              <h1 style="font-size: 2.5rem; margin-bottom: 20px; color: #2c3e50;">Nova Seção</h1>
              <p style="font-size: 1.1rem; color: #7f8c8d; margin-bottom: 20px;">Arraste outros blocos para cá para construir sua landing page.</p>
            </div>
          </section>
        `,
        category: 'Estrutura',
        attributes: { class: 'fas fa-layer-group' }
      });
      
      editor.BlockManager.add('hero-section', {
        label: 'Hero Section',
        content: `
          <section style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 80px 20px; text-align: center;">
            <div style="max-width: 800px; margin: 0 auto;">
              <h1 style="font-size: 3rem; margin-bottom: 20px; font-weight: bold;">Indique e Ganhe Recompensas</h1>
              <p style="font-size: 1.2rem; margin-bottom: 30px; opacity: 0.9;">Compartilhe com seus amigos e ganhe benefícios exclusivos a cada indicação bem-sucedida.</p>
              <button style="background: #e74c3c; color: white; padding: 15px 30px; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer;">Começar Agora</button>
            </div>
          </section>
        `,
        category: 'Estrutura',
        attributes: { class: 'fas fa-star' }
      });
      
      editor.BlockManager.add('2-columns', {
        label: '2 Colunas',
        content: `
          <div style="display: flex; gap: 20px; padding: 20px; max-width: 1200px; margin: 0 auto;">
            <div style="flex: 1; padding: 20px; border: 2px dashed #ddd; min-height: 200px;">
              <h3>Coluna 1</h3>
              <p>Arraste conteúdo aqui</p>
            </div>
            <div style="flex: 1; padding: 20px; border: 2px dashed #ddd; min-height: 200px;">
              <h3>Coluna 2</h3>
              <p>Arraste conteúdo aqui</p>
            </div>
          </div>
        `,
        category: 'Estrutura',
        attributes: { class: 'fas fa-columns' }
      });
      
      editor.BlockManager.add('text', {
        label: 'Texto',
        content: '<p style="line-height: 1.6; color: #444; margin: 15px 0;">Digite seu texto aqui. Você pode editá-lo facilmente clicando sobre ele.</p>',
        category: 'Conteúdo',
        attributes: { class: 'fas fa-font' }
      });
      
      editor.BlockManager.add('heading', {
        label: 'Título',
        content: '<h2 style="color: #2c3e50; margin: 20px 0; font-weight: 600;">Seu Título Aqui</h2>',
        category: 'Conteúdo',
        attributes: { class: 'fas fa-heading' }
      });
      
      editor.BlockManager.add('image', {
        label: 'Imagem',
        content: `
          <div style="text-align: center; margin: 20px 0;">
            <img src="https://via.placeholder.com/600x300/3498db/ffffff?text=Sua+Imagem" style="max-width: 100%; height: auto; border-radius: 8px;" alt="Imagem">
          </div>
        `,
        category: 'Conteúdo',
        attributes: { class: 'fas fa-image' }
      });
      
      editor.BlockManager.add('button', {
        label: 'Botão',
        content: `
          <div style="text-align: center; margin: 30px 0;">
            <button style="background: #3498db; color: white; padding: 12px 30px; border: none; border-radius: 6px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: background 0.3s;">
              Clique Aqui
            </button>
          </div>
        `,
        category: 'Conteúdo',
        attributes: { class: 'fas fa-mouse-pointer' }
      });
      
      editor.BlockManager.add('form', {
        label: 'Formulário de Indicação',
        content: `
          <form style="max-width: 500px; margin: 40px auto; padding: 30px; background: #f8f9fa; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <h3 style="text-align: center; margin-bottom: 25px; color: #2c3e50;">Indicar Amigo</h3>
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 5px; color: #555; font-weight: 500;">Nome Completo *</label>
              <input type="text" name="name" placeholder="Digite o nome completo" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem;" required>
            </div>
            <div style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 5px; color: #555; font-weight: 500;">E-mail *</label>
              <input type="email" placeholder="Digite o e-mail" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem;" required>
            </div>
            <div style="margin-bottom: 25px;">
              <label style="display: block; margin-bottom: 5px; color: #555; font-weight: 500;">Telefone *</label>
              <input type="tel" placeholder="Digite o telefone" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem;" required>
            </div>
            <button type="submit" style="width: 100%; background: #27ae60; color: white; padding: 15px; border: none; border-radius: 6px; font-size: 1.1rem; font-weight: bold; cursor: pointer;">Enviar Indicação</button>
          </form>
        `,
        category: 'Formulários',
        attributes: { class: 'fas fa-user-plus' }
      });
      
      editor.BlockManager.add('benefits', {
        label: 'Lista de Benefícios',
        content: `
          <div style="max-width: 800px; margin: 50px auto; padding: 0 20px;">
            <h2 style="text-align: center; margin-bottom: 40px; color: #2c3e50;">Por que Indicar?</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px;">
              <div style="text-align: center; padding: 20px;">
                <div style="width: 60px; height: 60px; background: #3498db; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;">
                  <i class="fas fa-gift" style="color: white; font-size: 24px;"></i>
                </div>
                <h4 style="margin-bottom: 10px; color: #2c3e50;">Recompensas</h4>
                <p style="color: #7f8c8d; line-height: 1.5;">Ganhe pontos e prêmios a cada indicação aprovada.</p>
              </div>
              <div style="text-align: center; padding: 20px;">
                <div style="width: 60px; height: 60px; background: #27ae60; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;">
                  <i class="fas fa-users" style="color: white; font-size: 24px;"></i>
                </div>
                <h4 style="margin-bottom: 10px; color: #2c3e50;">Comunidade</h4>
                <p style="color: #7f8c8d; line-height: 1.5;">Ajude seus amigos a descobrir algo incrível.</p>
              </div>
              <div style="text-align: center; padding: 20px;">
                <div style="width: 60px; height: 60px; background: #e74c3c; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;">
                  <i class="fas fa-rocket" style="color: white; font-size: 24px;"></i>
                </div>
                <h4 style="margin-bottom: 10px; color: #2c3e50;">Crescimento</h4>
                <p style="color: #7f8c8d; line-height: 1.5;">Seja parte do nosso crescimento e sucesso.</p>
              </div>
            </div>
          </div>
        `,
        category: 'Conteúdo',
        attributes: { class: 'fas fa-list-check' }
      });
      
      // Bloco Espaçador - Funcionalidade Essencial
      editor.BlockManager.add('spacer', {
        label: 'Espaçador',
        content: `
          <div style="height: 50px; width: 100%; background: transparent; border: 2px dashed #e0e0e0; display: flex; align-items: center; justify-content: center; color: #9e9e9e; font-size: 12px; font-family: Arial, sans-serif;" class="spacer-block">
            ↕️ Espaçador (50px)
          </div>
        `,
        category: 'Layout',
        attributes: { class: 'fas fa-arrows-alt-v' }
      });
      
      // Bloco Linha Divisória
      editor.BlockManager.add('divider', {
        label: 'Linha Divisória',
        content: `
          <div style="width: 100%; margin: 20px 0; text-align: center;">
            <hr style="border: none; height: 2px; background: linear-gradient(to right, transparent, #ddd, transparent); margin: 20px auto; max-width: 80%;">
          </div>
        `,
        category: 'Layout',
        attributes: { class: 'fas fa-minus' }
      });
      
      // Bloco Container Personalizado
      editor.BlockManager.add('custom-container', {
        label: 'Container Personalizado',
        content: `
          <div style="max-width: 1200px; margin: 0 auto; padding: 40px 20px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
            <h3 style="text-align: center; color: #6c757d; margin: 0; font-weight: 300;">
              📦 Container Personalizado
            </h3>
            <p style="text-align: center; color: #adb5bd; font-size: 14px; margin: 10px 0 0 0;">
              Arraste outros blocos para dentro deste container
            </p>
          </div>
        `,
        category: 'Layout',
        attributes: { class: 'fas fa-box' }
      });

      // Bloco Hero c/ Cadastro
      editor.BlockManager.add('hero-with-signup', {
        label: 'Hero c/ Cadastro',
        content: `
          <section style="background: #2c3e50; padding: 80px 20px; min-height: 90vh; display: flex; align-items: center; position: relative; overflow: hidden;">
            <!-- Elementos decorativos de fundo -->
            <div style="position: absolute; top: -100px; left: -100px; width: 300px; height: 300px; background: #f39c12; border-radius: 50%; opacity: 0.8;"></div>
            <div style="position: absolute; top: 0; right: 0; width: 500px; height: 500px; border: 2px solid rgba(243,156,18,0.3); border-radius: 50%;"></div>
            <div style="position: absolute; bottom: 0; right: 50px; width: 200px; height: 200px; border: 1px solid rgba(243,156,18,0.2); border-radius: 50%;"></div>
            
            <div style="max-width: 1400px; margin: 0 auto; width: 100%; position: relative; z-index: 2;">
              <div style="display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 80px; align-items: center;">
                
                <!-- Coluna Esquerda - Conteúdo Principal -->
                <div style="color: white;">
                  <!-- Logo -->
                  <div style="margin-bottom: 40px;">
                    <img src="https://via.placeholder.com/200x60/f39c12/ffffff?text=SUA+MARCA" alt="Logo" style="height: 60px; width: auto;">
                    <p style="color: #bdc3c7; font-size: 14px; margin: 8px 0 0 0; font-weight: 300;">
                      PROGRAMA DE INDICAÇÃO
                    </p>
                  </div>
                  
                  <!-- Texto de Convite Personalizado -->
                  <div style="margin-bottom: 40px;">
                    <h1 style="font-size: 2.8rem; font-weight: 400; line-height: 1.2; margin-bottom: 25px; color: white;">
                      <span style="font-weight: 300;">Transforme sua rede em</span><br>
                      <strong style="font-weight: 700;">fonte de renda extra</strong><br>
                      <span style="font-weight: 300;">e ainda ganhe</span>
                    </h1>
                    
                    <!-- Destaque da Oferta -->
                    <div style="background: #f39c12; color: #2c3e50; padding: 12px 25px; display: inline-block; font-size: 1.8rem; font-weight: bold; margin-bottom: 25px; transform: rotate(-2deg); box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                      R$ 500,00(*) por cada<br>
                      <span style="font-size: 2rem;">indicação válida!</span>
                    </div>
                  </div>
                  
                  <!-- Termos da Oferta -->
                  <div style="margin-bottom: 30px;">
                    <p style="font-size: 14px; color: #bdc3c7; line-height: 1.6; margin-bottom: 15px;">
                      (*) Valor por indicação convertida em cliente ativo.<br>
                      Cadastre-se como indicador oficial e comece a ganhar<br>
                      dinheiro compartilhando nossos produtos com sua rede.
                    </p>
                    <p style="font-size: 16px; color: #f39c12; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">
                      VAGAS LIMITADAS PARA INDICADORES
                    </p>
                  </div>
                  
                  <!-- Hashtag -->
                  <div style="font-size: 1.2rem; color: #f39c12; font-weight: 600; letter-spacing: 1px;">
                    #ProgramaDeIndicacao
                  </div>
                </div>
                
                <!-- Coluna Direita - Formulário de Cadastro -->
                <div style="background: white; padding: 40px; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.2);">
                  
                  <!-- Cabeçalho do Formulário -->
                  <div style="text-align: center; margin-bottom: 30px;">
                    <h3 style="font-size: 1.5rem; color: #2c3e50; margin-bottom: 10px; font-weight: 600;">
                      Cadastre-se e comece<br>
                      a ganhar hoje mesmo!
                    </h3>
                    <p style="color: #6c757d; font-size: 13px; margin: 15px 0; display: flex; align-items: center; justify-content: center; gap: 5px;">
                      <span style="font-size: 16px;">🔒</span> Cadastro 100% gratuito
                    </p>
                  </div>
                  
                  <!-- Formulário -->
                  <form style="display: flex; flex-direction: column; gap: 20px; margin-bottom: 25px;">
                    <!-- Campo Nome -->
                    <div>
                      <label style="display: block; color: #495057; font-size: 14px; font-weight: 500; margin-bottom: 5px;">Nome Completo</label>
                      <input 
                        type="text" 
                        name="name"
                        placeholder="" 
                        style="width: 100%; padding: 15px; border: none; border-bottom: 2px solid #e9ecef; background: transparent; font-size: 16px; transition: all 0.3s ease; outline: none; color: #495057;"
                        onfocus="this.style.borderBottomColor='#f39c12'"
                        onblur="this.style.borderBottomColor='#e9ecef'"
                      >
                    </div>
                    
                    <!-- Campo Email -->
                    <div>
                      <label style="display: block; color: #495057; font-size: 14px; font-weight: 500; margin-bottom: 5px;">Seu melhor e-mail</label>
                      <input 
                        type="email" 
                        placeholder="" 
                        style="width: 100%; padding: 15px; border: none; border-bottom: 2px solid #e9ecef; background: transparent; font-size: 16px; transition: all 0.3s ease; outline: none; color: #495057;"
                        onfocus="this.style.borderBottomColor='#f39c12'"
                        onblur="this.style.borderBottomColor='#e9ecef'"
                      >
                    </div>
                    
                    <!-- Campo WhatsApp -->
                    <div>
                      <label style="display: block; color: #495057; font-size: 14px; font-weight: 500; margin-bottom: 5px;">WhatsApp</label>
                      <input 
                        type="tel" 
                        placeholder="(11) 99999-9999" 
                        style="width: 100%; padding: 15px; border: none; border-bottom: 2px solid #e9ecef; background: transparent; font-size: 16px; transition: all 0.3s ease; outline: none; color: #495057;"
                        onfocus="this.style.borderBottomColor='#f39c12'"
                        onblur="this.style.borderBottomColor='#e9ecef'"
                      >
                    </div>
                    
                    <!-- Botão Principal -->
                    <button 
                      type="submit" 
                      style="background: #27ae60; color: white; padding: 18px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 10px; text-transform: uppercase; letter-spacing: 0.5px;"
                      onmouseover="this.style.backgroundColor='#229954'; this.style.transform='translateY(-2px)'"
                      onmouseout="this.style.backgroundColor='#27ae60'; this.style.transform='translateY(0)'"
                    >
                      🚀 QUERO SER UM INDICADOR
                    </button>
                  </form>
                  
                  <!-- Garantia -->
                  <div style="text-align: center; margin-top: 20px;">
                    <p style="color: #6c757d; font-size: 12px; margin: 0; line-height: 1.4;">
                      ✅ Sem mensalidades • Sem taxas • Apenas ganhe!<br>
                      💰 Pagamentos via PIX a cada indicação convertida
                    </p>
                  </div>
                </div>
              </div>
              
              <!-- CSS Responsivo -->
              <style>
                @media (max-width: 1024px) {
                  div[style*="grid-template-columns: 1.3fr 0.7fr"] {
                    grid-template-columns: 1fr !important;
                    gap: 40px !important;
                    text-align: center;
                  }
                  h1 {
                    font-size: 2.2rem !important;
                  }
                  div[style*="transform: rotate(-2deg)"] {
                    transform: none !important;
                    margin: 20px auto !important;
                  }
                }
                
                @media (max-width: 768px) {
                  section {
                    padding: 40px 15px !important;
                    min-height: auto !important;
                  }
                  h1 {
                    font-size: 1.8rem !important;
                  }
                  div[style*="padding: 40px"] {
                    padding: 25px !important;
                  }
                  div[style*="font-size: 1.8rem"] {
                    font-size: 1.4rem !important;
                  }
                  div[style*="font-size: 2rem"] {
                    font-size: 1.6rem !important;
                  }
                }
              </style>
            </div>
          </section>
        `,
        category: 'Seções',
        attributes: { class: 'fas fa-rocket' }
      });

      console.log('[GrapesJS Debug] Blocos adicionados. Total de blocos:', editor.BlockManager.getAll().length);

      // Verificar se está no modo de edição e carregar dados existentes
      const urlParams = new URLSearchParams(window.location.search);
      const isEditMode = urlParams.get('edit') === 'true';
      
      if (isEditMode) {
        console.log('[GrapesJS Debug] Modo de edição detectado - carregando dados existentes...');
        
        const existingHtml = localStorage.getItem('grapesLPHtml');
        const existingCss = localStorage.getItem('grapesLPCss');
        
        if (existingHtml && existingCss) {
          // Remove o wrapper se existir
          const cleanHtml = existingHtml.replace(/<div class='gjs-lp-wrapper'>(.*)<\/div>/s, '$1');
          
          // Carrega o conteúdo existente no editor
          editor.setComponents(cleanHtml);
          editor.setStyle(existingCss);
          
          console.log('[GrapesJS Debug] Dados carregados com sucesso!');
          
          // Atualizar título da página para indicar modo de edição
          document.title = 'Editar LP de Indicadores - Editor Visual';
          document.querySelector('.editor-header h1').textContent = '✏️ Editando LP de Indicadores';
        } else {
          console.log('[GrapesJS Debug] Nenhum dado encontrado para editar');
          alert('Nenhum conteúdo encontrado para editar. Redirecionando para criar nova LP...');
          window.location.href = 'lp-editor-grapes.html';
        }
      } else {
        console.log('[GrapesJS Debug] Modo de criação - inicializando com conteúdo padrão');
        
        // Adicionar conteúdo inicial de exemplo apenas no modo de criação
        editor.setComponents(`
          <section style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 80px 20px; text-align: center;">
            <div style="max-width: 800px; margin: 0 auto;">
              <h1 style="font-size: 3rem; margin-bottom: 20px; font-weight: bold;">Indique e Ganhe Recompensas</h1>
              <p style="font-size: 1.2rem; margin-bottom: 30px; opacity: 0.9;">Comece arrastando blocos da barra lateral para construir sua landing page personalizada.</p>
              <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; border: 2px dashed rgba(255,255,255,0.3);">
                <p style="margin: 0; font-size: 1rem;">👈 Arraste blocos da seção "Blocos" para cá</p>
              </div>
            </div>
          </section>
        `);
      }

      // Salvar estrutura (simulação)
      window.saveGrapesLP = function() {
        const html = editor.getHtml();
        const css = editor.getCss();
        // Salva um wrapper para garantir preview correto
        const wrappedHtml = `<div class='gjs-lp-wrapper'>${html}</div>`;
        localStorage.setItem('grapesLPHtml', wrappedHtml);
        localStorage.setItem('grapesLPCss', css);
        // Salva data de criação se não existir
        if (!localStorage.getItem('grapesLPCreatedAt')) {
          localStorage.setItem('grapesLPCreatedAt', new Date().toLocaleString('pt-BR'));
        }
        alert('LP salva localmente! (Simulação)');
      };

      console.log('[GrapesJS Debug] Configuração completa!');
      
      // Log para confirmar melhorias de contraste
      console.log('[GrapesJS Debug] Estilos de contraste aplicados para melhor legibilidade do painel de estilos!');
      
      // Funcionalidades avançadas do editor de estilos
      setTimeout(() => {
        // Adicionar tooltips informativos nos setores
        const sectors = {
          '📦 Container & Espaçamento': 'Defina tamanhos, espaçamentos e posicionamento',
          '🖼️ Fundo & Cores': 'Configure cores, imagens e padrões de fundo',
          '✏️ Fontes & Tipografia': 'Personalize textos, fontes e estilos de escrita',
          '📐 Posicionamento': 'Defina posições e visibilidades',
          '🔄 Layout Flexível': 'Configure layouts flexíveis e responsivos',
          '🔲 Bordas & Efeitos': 'Adicione bordas, cantos arredondados e efeitos',
          '✨ Transformações': 'Aplique transformações, animações e filtros'
        };
        
        // Aplicar tooltips
        Object.keys(sectors).forEach(sectorName => {
          const sectorElement = Array.from(document.querySelectorAll('.gjs-sm-title')).find(el => 
            el.textContent.includes(sectorName)
          );
          if (sectorElement) {
            sectorElement.title = sectors[sectorName];
            sectorElement.style.cursor = 'help';
          }
        });
        
        // Atalhos de teclado para estilos comuns
        document.addEventListener('keydown', (e) => {
          if (e.ctrlKey || e.metaKey) {
            const selectedComponent = editor.getSelected();
            if (selectedComponent) {
              switch(e.key) {
                case 'b':
                  e.preventDefault();
                  selectedComponent.addStyle({'font-weight': 'bold'});
                  console.log('[GrapesJS Debug] Atalho: Texto em negrito aplicado');
                  break;
                case 'i':
                  e.preventDefault();
                  selectedComponent.addStyle({'font-style': 'italic'});
                  console.log('[GrapesJS Debug] Atalho: Texto em itálico aplicado');
                  break;
                case 'u':
                  e.preventDefault();
                  selectedComponent.addStyle({'text-decoration': 'underline'});
                  console.log('[GrapesJS Debug] Atalho: Texto sublinhado aplicado');
                  break;
              }
            }
          }
        });
        
        console.log('[GrapesJS Debug] Funcionalidades avançadas do editor de estilos ativadas!');
        console.log('[GrapesJS Debug] Atalhos disponíveis: Ctrl+B (negrito), Ctrl+I (itálico), Ctrl+U (sublinhado)');
      }, 500);
      
      // Sistema de Abas
      function initTabs() {
        const tabs = document.querySelectorAll('.panel__tab');
        const contents = document.querySelectorAll('.panel__tab-content');
        
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            const targetTab = tab.dataset.tab;
            
            // Remove active de todas as abas
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            // Adiciona active na aba clicada
            tab.classList.add('active');
            document.getElementById(`tab-${targetTab}`).classList.add('active');
            
            // Log para debug
            console.log(`[GrapesJS Debug] Aba ativada: ${targetTab}`);
          });
        });
      }
      
      // Inicializar abas após carregar o editor
      setTimeout(initTabs, 100);
      
      // Melhorar feedback visual para seleção de elementos
      editor.on('component:selected', (component) => {
        console.log('[GrapesJS Debug] Elemento selecionado:', component.get('tagName'));
        
        // Remover classe empty dos painéis
        document.getElementById('tab-styles').classList.remove('empty');
        document.getElementById('tab-traits').classList.remove('empty');
        
        // Adicionar indicador de conteúdo nas abas
        document.querySelector('[data-tab="styles"]').classList.add('has-content');
        
        // Auto-mostrar aba de estilos para elementos visuais
        const visualElements = ['div', 'section', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'span', 'button', 'img'];
        if (visualElements.includes(component.get('tagName'))) {
          document.querySelector('[data-tab="styles"]').click();
        }
        
        // Verificar se tem propriedades
        if (component.get('traits').length > 0) {
          document.querySelector('[data-tab="traits"]').classList.add('has-content');
        } else {
          document.querySelector('[data-tab="traits"]').classList.remove('has-content');
        }
        
        // Adicionar feedback visual específico por tipo de elemento
        setTimeout(() => {
          const tagName = component.get('tagName');
          const styleContainer = document.querySelector('#tab-styles .styles-container');
          
          // Limpar feedbacks anteriores
          const existingTips = styleContainer.querySelectorAll('.element-tip');
          existingTips.forEach(tip => tip.remove());
          
          // Adicionar dica específica para o tipo de elemento
          const tip = document.createElement('div');
          tip.className = 'element-tip';
          tip.style.cssText = `
            background: #fff3e0; 
            border: 1px solid #ffb74d; 
            border-radius: 4px; 
            padding: 8px 12px; 
            margin: 10px 0; 
            font-size: 11px; 
            color: #e65100;
          `;
          
          switch(tagName) {
            case 'h1':
            case 'h2':
            case 'h3':
            case 'h4':
            case 'h5':
            case 'h6':
              tip.innerHTML = `💡 <strong>Título selecionado:</strong> Ajuste font-size, font-weight e color na seção Tipografia`;
              break;
            case 'p':
            case 'span':
              tip.innerHTML = `💡 <strong>Texto selecionado:</strong> Personalize cores, tamanhos e espaçamento na seção Tipografia`;
              break;
            case 'div':
            case 'section':
              tip.innerHTML = `💡 <strong>Container selecionado:</strong> Configure layout, padding/margin e background`;
              break;
            case 'button':
              tip.innerHTML = `💡 <strong>Botão selecionado:</strong> Personalize cores, bordas e efeitos hover`;
              break;
            case 'img':
              tip.innerHTML = `💡 <strong>Imagem selecionada:</strong> Ajuste dimensões, bordas e posicionamento`;
              break;
            default:
              tip.innerHTML = `💡 <strong>Elemento ${tagName} selecionado:</strong> Use os painéis abaixo para personalizar`;
          }
          
          styleContainer.insertBefore(tip, styleContainer.firstChild.nextSibling);
          
          // Adicionar botões de ação rápida para elementos específicos
          const quickActions = document.createElement('div');
          quickActions.className = 'quick-actions';
          quickActions.style.cssText = `
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            border-radius: 4px; 
            padding: 8px; 
            margin: 10px 0; 
            display: flex; 
            gap: 5px; 
            flex-wrap: wrap;
          `;
          
          // Botões específicos por tipo de elemento
          if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'span'].includes(tagName)) {
            // Botões para elementos de texto
            quickActions.innerHTML = `
              <button onclick="editor.getSelected().addStyle({'font-weight': 'bold'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #fff; border-radius: 3px; cursor: pointer;">Bold</button>
              <button onclick="editor.getSelected().addStyle({'font-style': 'italic'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #fff; border-radius: 3px; cursor: pointer;">Italic</button>
              <button onclick="editor.getSelected().addStyle({'text-align': 'center'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #fff; border-radius: 3px; cursor: pointer;">Center</button>
              <button onclick="editor.getSelected().addStyle({'color': '#3498db'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #fff; border-radius: 3px; cursor: pointer; color: #3498db;">Azul</button>
              <button onclick="editor.getSelected().addStyle({'color': '#e74c3c'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #fff; border-radius: 3px; cursor: pointer; color: #e74c3c;">Vermelho</button>
            `;
          } else if (['div', 'section'].includes(tagName)) {
            // Botões para containers
            quickActions.innerHTML = `
              <button onclick="editor.getSelected().addStyle({'padding': '20px'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #fff; border-radius: 3px; cursor: pointer;">Padding 20px</button>
              <button onclick="editor.getSelected().addStyle({'margin': '20px auto'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #fff; border-radius: 3px; cursor: pointer;">Centralizar</button>
              <button onclick="editor.getSelected().addStyle({'background-color': '#f8f9fa'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #f8f9fa; border-radius: 3px; cursor: pointer;">Fundo Cinza</button>
              <button onclick="editor.getSelected().addStyle({'background-color': '#e3f2fd'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #e3f2fd; border-radius: 3px; cursor: pointer;">Fundo Azul</button>
              <button onclick="editor.getSelected().addStyle({'border-radius': '8px'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #fff; border-radius: 3px; cursor: pointer;">Cantos Arredondados</button>
            `;
          } else if (tagName === 'button') {
            // Botões para botões
            quickActions.innerHTML = `
              <button onclick="editor.getSelected().addStyle({'background-color': '#3498db', 'color': 'white'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #3498db; color: white; border-radius: 3px; cursor: pointer;">Azul</button>
              <button onclick="editor.getSelected().addStyle({'background-color': '#27ae60', 'color': 'white'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #27ae60; color: white; border-radius: 3px; cursor: pointer;">Verde</button>
              <button onclick="editor.getSelected().addStyle({'background-color': '#e74c3c', 'color': 'white'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #e74c3c; color: white; border-radius: 3px; cursor: pointer;">Vermelho</button>
              <button onclick="editor.getSelected().addStyle({'border-radius': '25px'})" style="padding: 4px 8px; font-size: 11px; border: 1px solid #ccc; background: #fff; border-radius: 3px; cursor: pointer;">Arredondado</button>
            `;
          }
          
          if (quickActions.innerHTML.trim()) {
            const quickTitle = document.createElement('div');
            quickTitle.style.cssText = 'font-size: 11px; font-weight: 600; color: #495057; margin-bottom: 5px;';
            quickTitle.textContent = '⚡ Ações Rápidas:';
            quickActions.insertBefore(quickTitle, quickActions.firstChild);
            styleContainer.insertBefore(quickActions, tip.nextSibling);
          }
        }, 100);
      });
      
      // Feedback quando nenhum elemento estiver selecionado
      editor.on('component:deselected', () => {
        console.log('[GrapesJS Debug] Nenhum elemento selecionado');
        
        // Adicionar classe empty e remover indicadores
        document.getElementById('tab-styles').classList.add('empty');
        document.getElementById('tab-traits').classList.add('empty');
        document.querySelector('[data-tab="styles"]').classList.remove('has-content');
        document.querySelector('[data-tab="traits"]').classList.remove('has-content');
        
        // Voltar para aba de blocos
        document.querySelector('[data-tab="blocks"]').click();
      });
      
      // Inicializar estado vazio
      document.getElementById('tab-styles').classList.add('empty');
      document.getElementById('tab-traits').classList.add('empty');
      
      // Função para alternar visibilidade do painel lateral
      window.toggleSidebar = function() {
        const panel = document.querySelector('.panel__right');
        const btn = document.querySelector('.panel__toggle-btn');
        const icon = btn.querySelector('i');
        
        panel.classList.toggle('collapsed');
        
        if (panel.classList.contains('collapsed')) {
          icon.className = 'fas fa-chevron-right';
          btn.title = 'Mostrar painel de componentes';
        } else {
          icon.className = 'fas fa-bars';
          btn.title = 'Esconder painel de componentes';
        }
        
        console.log('[GrapesJS Debug] Painel lateral toggled');
      };
      
      // Controle dos botões de dispositivo no header
      function initDeviceControls() {
        const deviceButtons = document.querySelectorAll('.btn-device');
        
        deviceButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            const device = btn.dataset.device;
            
            // Remove active de todos os botões
            deviceButtons.forEach(b => b.classList.remove('active'));
            // Adiciona active no botão clicado
            btn.classList.add('active');
            
            // Atualiza o device no GrapesJS
            if (device === 'desktop') {
              editor.setDevice('Desktop');
            } else if (device === 'mobile') {
              editor.setDevice('Mobile');
            }
            
            console.log(`[GrapesJS Debug] Dispositivo alterado para: ${device}`);
          });
        });
      }
      
      // Inicializar controles de dispositivo
      initDeviceControls();
      
      // Funcionalidade especial para o bloco espaçador
      editor.on('component:add', (component) => {
        if (component.get('classes').includes('spacer-block')) {
          console.log('[GrapesJS Debug] Espaçador adicionado - configurando funcionalidade especial');
          
          // Adicionar funcionalidade de redimensionamento rápido
          component.set('script', function() {
            const element = this;
            const heights = [20, 30, 50, 80, 100, 150];
            let currentIndex = 2; // 50px é o padrão
            
            element.addEventListener('dblclick', function() {
              currentIndex = (currentIndex + 1) % heights.length;
              const newHeight = heights[currentIndex];
              this.style.height = newHeight + 'px';
              this.innerHTML = `↕️ Espaçador (${newHeight}px)`;
            });
          });
          
          // Adicionar traits personalizados para o espaçador
          component.set('traits', [
            {
              type: 'number',
              name: 'height',
              label: 'Altura (px)',
              value: 50,
              min: 10,
              max: 500,
              changeProp: true
            }
          ]);
        }
      });
      
      // Melhorar feedback visual para edição de espaçador
      editor.on('component:selected', (component) => {
        if (component.get('classes').includes('spacer-block')) {
          // Adicionar dica especial para espaçador
          setTimeout(() => {
            const tip = document.querySelector('.element-tip');
            if (tip) {
              tip.innerHTML = `💡 <strong>Espaçador selecionado:</strong> Duplo-clique para alterar tamanho rapidamente ou use o painel Propriedades`;
              tip.style.background = '#e8f5e8';
              tip.style.borderColor = '#4caf50';
            }
          }, 100);
        }
      });
      
    } catch (error) {
      console.error('[GrapesJS Debug] ERRO na inicialização:', error);
    }
  </script>
  <script>
    // Tornar campo de nome readonly em modo de edição e carregar dados da LP
    (async function() {
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get('id');
      if (id) {
        const nomeInput = document.getElementById('nomeLP');
        if (nomeInput) nomeInput.readOnly = true;
        // Buscar dados da LP do backend
        const token = localStorage.getItem('clientToken');
        if (token) {
          try {
            const response = await fetch(`http://localhost:3000/api/lp-indicadores/${id}`, {
              headers: { 'Authorization': `Bearer ${token}` }
            });
            if (response.ok) {
              const result = await response.json();
              const lp = result.data || result;
              if (lp && nomeInput) {
                nomeInput.value = lp.name || '';
                window.currentSlug = lp.slug;
                window.currentStatus = lp.status || 'draft';
                window.currentClientId = lp.clientId?._id || lp.clientId || localStorage.getItem('clientId');
                // Opcional: preencher o editor com os dados da LP
                if (window.editor && lp.compiledOutput) {
                  window.editor.setComponents(lp.compiledOutput.html || '');
                  window.editor.setStyle(lp.compiledOutput.css || '');
                }
              }
            } else {
              alert('Erro ao carregar dados da LP para edição.');
            }
          } catch (err) {
            alert('Erro ao buscar dados da LP: ' + err.message);
          }
        }
      }
    })();

    // Função global para salvar a LP no backend
    window.saveLP = async function() {
      try {
        const html = editor.getHtml();
        const css = editor.getCss();
        const nameInput = document.getElementById('nomeLP');
        const name = nameInput ? nameInput.value.trim() : 'LP de Indicadores';
        // Detectar modo edição
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const isEdit = !!id;
        let slug;
        let status = 'draft';
        let clientId = localStorage.getItem('clientId');
        if (isEdit) {
          // Em edição, manter o slug e status originais
          slug = window.currentSlug;
          status = window.currentStatus || 'draft';
          clientId = window.currentClientId || clientId;
        } else {
          // Função para gerar slug
          function generateSlug(name) {
            return name
              .toLowerCase()
              .normalize('NFD').replace(/\u0300-\u036f/g, '') // Remove acentos corretamente
              .replace(/[^a-z0-9]+/g, '-')
              .replace(/(^-|-$)+/g, '');
          }
          slug = generateSlug(name);
        }
        console.log('[saveLP] isEdit:', isEdit, 'slug:', slug, 'status:', status, 'clientId:', clientId, 'window.currentSlug:', window.currentSlug);
        if (!slug) {
          alert('Erro ao gerar o slug da LP. Verifique o nome informado.');
          return;
        }
        if (!clientId) {
          alert('Erro: clientId não encontrado. Faça login novamente.');
          return;
        }
        // Montar payload conforme backend espera
        const payload = {
          name,
          slug,
          clientId,
          grapesData: { components: editor.getComponents().map(c => c.toJSON()), styles: [], assets: [] },
          compiledOutput: { html, css },
          metadata: { blocksUsed: [], version: '1.0' },
          status
        };
        if (isEdit) {
          payload._id = id;
        }
        const endpoint = isEdit
          ? `http://localhost:3000/api/lp-indicadores/${id}`
          : 'http://localhost:3000/api/lp-indicadores';
        const method = isEdit ? 'PATCH' : 'POST';
        const token = localStorage.getItem('clientToken');
        const response = await fetch(endpoint, {
          method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(payload)
        });
        const result = await response.json();
        if (response.ok && result.success) {
          alert('LP salva com sucesso no sistema!');
        } else {
          alert('Erro ao salvar LP: ' + (result.message || 'Erro desconhecido'));
        }
      } catch (error) {
        alert('Erro ao salvar LP: ' + error.message);
        console.error('[saveLP] Erro:', error);
      }
    };
  </script>
  <!-- <script src="../js/lp-indicadores-edit.js"></script> -->
</body>
</html> 

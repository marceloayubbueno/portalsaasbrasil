<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuração de Integrações - Programa de Indicação</title>
    <link rel="stylesheet" href="../css/tailwind.output.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <nav class="w-64 bg-gray-800 flex-shrink-0 flex flex-col py-6 px-4 min-h-screen text-gray-100">
        <div class="flex items-center mb-8">
          <span class="text-2xl font-bold text-blue-400">Programa de Indicação</span>
        </div>
        <ul class="space-y-2 flex-1">
          <li><a href="dashboard.html" class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-chart-line mr-2"></i> Dashboard</a></li>
          <li><a href="participants.html" class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-users mr-2"></i> Central de Participantes</a></li>
          <li><a href="lp-indicadores.html" class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-clipboard-list mr-2"></i> Lp de indicadores</a></li>
          <li><a href="rewards.html" class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-gift mr-2"></i> Recompensas</a></li>
          <li><a href="lp-divulgacao.html" class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-bullhorn mr-2"></i> Lp de divulgação</a></li>
          <li><a href="campaigns.html" class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-rocket mr-2"></i> Campanhas</a></li>
          <!-- Engajamento e-mail -->
          <li>
            <div class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700 cursor-pointer group" onclick="toggleEngagementEmailMenu()">
              <i class="fas fa-envelope mr-2"></i> Engajamento e-mail
              <span class="ml-2"></span><i class="fas fa-chevron-right transition-transform duration-200" id="engagementEmailArrow" style="transform: rotate(0deg);"></i>
            </div>
            <ul id="engagementEmailMenu" class="ml-8 mt-1 space-y-1 hidden">
              <li><a href="engajamento-email-marketing.html" class="flex items-center pl-10 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-chart-bar mr-2"></i> E-mail marketing</a></li>
              <li><a href="engajamento-email-flows.html" class="flex items-center pl-10 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-sitemap mr-2"></i> Fluxos de E-mail</a></li>
            </ul>
          </li>
          <!-- Engajamentos Whatsapp -->
          <li><a href="#" class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-whatsapp mr-2"></i> Engajamentos Whatsapp</a></li>
          <li><a href="referrals.html" class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-user-plus mr-2"></i> Gestão de leads</a></li>
          <!-- Financeiro -->
          <li>
            <div class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700 cursor-pointer group" onclick="toggleFinanceMenu()">
              <i class="fas fa-wallet mr-2"></i> Financeiro
              <span class="ml-2"></span><i class="fas fa-chevron-right transition-transform duration-200" id="financeArrow" style="transform: rotate(0deg);"></i>
            </div>
            <ul id="financeMenu" class="ml-8 mt-1 space-y-1 hidden">
              <li><a href="carteira.html" class="flex items-center pl-10 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-piggy-bank mr-2"></i> Carteira</a></li>
              <li><a href="payments.html" class="flex items-center pl-10 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-money-bill-wave mr-2"></i> Pagamentos</a></li>
            </ul>
          </li>
          <!-- Configurações -->
          <li>
            <div class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700 cursor-pointer group" onclick="toggleSettingsMenu()">
              <i class="fas fa-cog mr-2"></i> Configurações
              <span class="ml-2"></span><i class="fas fa-chevron-right transition-transform duration-200" id="settingsArrow" style="transform: rotate(90deg);"></i>
            </div>
            <ul id="settingsMenu" class="ml-8 mt-1 space-y-1">
              <li><a href="my-data.html" class="flex items-center pl-10 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-user mr-2"></i> Meus dados</a></li>
              <li><a href="email-config.html" class="flex items-center pl-10 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-envelope-open mr-2"></i> Configuração de e-mail</a></li>
              <li><a href="#" class="flex items-center pl-10 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-whatsapp mr-2"></i> Configuração de whatsapp</a></li>
              <li><a href="configuracao-integracoes.html" class="flex items-center pl-10 py-2 rounded-lg bg-gray-800 text-blue-400 font-semibold"><i class="fas fa-plug mr-2"></i> Configuração Integrações</a></li>
            </ul>
          </li>
          <li><a href="#" onclick="logout()" class="flex items-center pl-4 px-3 py-2 rounded-lg hover:bg-gray-700"><i class="fas fa-sign-out-alt mr-2"></i> Sair</a></li>
        </ul>
      </nav>

      <!-- Main Content -->
      <main class="flex-1 p-8">
        <!-- Header -->
        <div class="mb-8">
          <h1 class="text-3xl font-bold text-white mb-2">
            <i class="fas fa-plug mr-3 text-blue-400"></i>
            Configuração de Integrações
          </h1>
          <p class="text-gray-400">Gerencie todas as integrações da sua conta</p>
        </div>

        <!-- Grid de Integrações -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          
          <!-- Make.com Webhook -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-blue-500 transition-colors">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center mr-4">
                <i class="fas fa-link text-white text-xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">Make.com</h3>
                <p class="text-gray-400 text-sm">Webhooks</p>
              </div>
            </div>
            <p class="text-gray-300 mb-4">Configure webhooks para automatizar processos com Make.com (ex-Integromat)</p>
            
            <!-- Formulário Make.com -->
            <form id="webhookMakeForm" class="space-y-4">
              <div>
                <label for="makeWebhookUrl" class="block text-gray-300 text-sm font-medium mb-2">URL do Webhook</label>
                <input 
                  type="url" 
                  id="makeWebhookUrl" 
                  placeholder="https://hook.us2.make.com/xxxxxxx" 
                  class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                <p id="makeWebhookError" class="text-red-400 text-xs mt-1 hidden">Insira uma URL válida.</p>
              </div>
              <button 
                type="submit" 
                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors font-medium"
              >
                Salvar Webhook
              </button>
              <div class="text-center">
                <p id="makeWebhookSuccess" class="text-green-400 text-sm hidden">Webhook salvo com sucesso!</p>
                <p id="makeWebhookFail" class="text-red-400 text-sm hidden">Erro ao salvar. Tente novamente.</p>
              </div>
            </form>
          </div>

          <!-- Zapier Integration (Placeholder) -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 opacity-50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-orange-600 rounded-lg flex items-center justify-center mr-4">
                <i class="fas fa-bolt text-white text-xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">Zapier</h3>
                <p class="text-gray-400 text-sm">Em breve</p>
              </div>
            </div>
            <p class="text-gray-300 mb-4">Integração com Zapier para automatizar workflows</p>
            <button disabled class="w-full bg-gray-600 text-gray-400 py-2 px-4 rounded-lg cursor-not-allowed">
              Em desenvolvimento
            </button>
          </div>

          <!-- Webhook Personalizado (Placeholder) -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 opacity-50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center mr-4">
                <i class="fas fa-code text-white text-xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">Webhook Personalizado</h3>
                <p class="text-gray-400 text-sm">Em breve</p>
              </div>
            </div>
            <p class="text-gray-300 mb-4">Configure webhooks personalizados para suas próprias aplicações</p>
            <button disabled class="w-full bg-gray-600 text-gray-400 py-2 px-4 rounded-lg cursor-not-allowed">
              Em desenvolvimento
            </button>
          </div>

          <!-- API Integration (Placeholder) -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 opacity-50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center mr-4">
                <i class="fas fa-api text-white text-xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">API REST</h3>
                <p class="text-gray-400 text-sm">Em breve</p>
              </div>
            </div>
            <p class="text-gray-300 mb-4">Chaves de API para integração direta com nossa plataforma</p>
            <button disabled class="w-full bg-gray-600 text-gray-400 py-2 px-4 rounded-lg cursor-not-allowed">
              Em desenvolvimento
            </button>
          </div>

          <!-- CRM Integration (Placeholder) -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 opacity-50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-red-600 rounded-lg flex items-center justify-center mr-4">
                <i class="fas fa-users-cog text-white text-xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">CRM</h3>
                <p class="text-gray-400 text-sm">Em breve</p>
              </div>
            </div>
            <p class="text-gray-300 mb-4">Integração com sistemas de CRM populares</p>
            <button disabled class="w-full bg-gray-600 text-gray-400 py-2 px-4 rounded-lg cursor-not-allowed">
              Em desenvolvimento
            </button>
          </div>

          <!-- Email Marketing Integration (Placeholder) -->
          <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 opacity-50">
            <div class="flex items-center mb-4">
              <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mr-4">
                <i class="fas fa-envelope-open text-white text-xl"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white">Email Marketing</h3>
                <p class="text-gray-400 text-sm">Em breve</p>
              </div>
            </div>
            <p class="text-gray-300 mb-4">Integração com plataformas de email marketing</p>
            <button disabled class="w-full bg-gray-600 text-gray-400 py-2 px-4 rounded-lg cursor-not-allowed">
              Em desenvolvimento
            </button>
          </div>

        </div>

        <!-- Seção de Documentação -->
        <div class="mt-12 bg-gray-800 rounded-lg p-6 border border-gray-700">
          <h2 class="text-2xl font-bold text-white mb-4">
            <i class="fas fa-book mr-2 text-blue-400"></i>
            Documentação das Integrações
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="text-lg font-semibold text-white mb-2">Make.com Webhook</h3>
              <p class="text-gray-300 mb-2">O webhook será acionado quando:</p>
              <ul class="text-gray-400 space-y-1 text-sm">
                <li>• Nova indicação é criada</li>
                <li>• Participante é aprovado</li>
                <li>• Recompensa é liberada</li>
                <li>• Status de campanha é alterado</li>
              </ul>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-white mb-2">Payload de Exemplo</h3>
              <pre class="bg-gray-900 p-3 rounded text-xs text-gray-300 overflow-x-auto">
{
  "event": "referral_created",
  "data": {
    "referralId": "123",
    "campaignId": "456",
    "referrerEmail": "user@example.com",
    "referredEmail": "friend@example.com"
  }
}
              </pre>
            </div>
          </div>
        </div>

      </main>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
    <script>
      // Toggle Finance Menu
      function toggleFinanceMenu() {
        const menu = document.getElementById('financeMenu');
        const arrow = document.getElementById('financeArrow');
        menu.classList.toggle('hidden');
        arrow.style.transform = menu.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(90deg)';
      }

      // Toggle Settings Menu
      function toggleSettingsMenu() {
        const menu = document.getElementById('settingsMenu');
        const arrow = document.getElementById('settingsArrow');
        menu.classList.toggle('hidden');
        arrow.style.transform = menu.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(90deg)';
      }

      // Toggle Engagement Email Menu
      function toggleEngagementEmailMenu() {
        const menu = document.getElementById('engagementEmailMenu');
        const arrow = document.getElementById('engagementEmailArrow');
        menu.classList.toggle('hidden');
        arrow.style.transform = menu.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(90deg)';
      }

      // Make.com Webhook Form
      document.getElementById('webhookMakeForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const url = document.getElementById('makeWebhookUrl').value.trim();
        const error = document.getElementById('makeWebhookError');
        const success = document.getElementById('makeWebhookSuccess');
        const fail = document.getElementById('makeWebhookFail');
        
        // Reset messages
        error.classList.add('hidden');
        success.classList.add('hidden');
        fail.classList.add('hidden');
        
        // Validate URL
        try {
          new URL(url);
        } catch {
          error.classList.remove('hidden');
          return;
        }
        
        // API call to save webhook
        try {
          const token = localStorage.getItem('clientToken');
          const apiUrl = window.APP_CONFIG ? window.APP_CONFIG.apiBaseUrl : 'http://localhost:3000';
          
          const response = await fetch(`${apiUrl}/api/clients/me/webhook-make`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ webhookUrl: url })
          });
          
          if (response.ok) {
            success.classList.remove('hidden');
          } else {
            fail.classList.remove('hidden');
          }
        } catch (err) {
          console.error('Error saving webhook:', err);
          fail.classList.remove('hidden');
        }
      });

      // Load existing webhook URL on page load
      async function loadWebhookUrl() {
        try {
          const token = localStorage.getItem('clientToken');
          const apiUrl = window.APP_CONFIG ? window.APP_CONFIG.apiBaseUrl : 'http://localhost:3000';
          
          const response = await fetch(`${apiUrl}/api/clients/me`, {
            headers: {
              'Authorization': 'Bearer ' + token
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            if (data.webhookMakeUrl) {
              document.getElementById('makeWebhookUrl').value = data.webhookMakeUrl;
            }
          }
        } catch (err) {
          console.error('Error loading webhook URL:', err);
        }
      }

      // Logout function
      function logout() {
        localStorage.removeItem('clientToken');
        localStorage.removeItem('clientData');
        localStorage.removeItem('clientId');
        window.location.href = 'login.html';
      }

      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        checkAuth();
        loadWebhookUrl();
      });
    </script>
</body>
</html> 
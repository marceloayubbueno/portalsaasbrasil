<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Preview da LP de Indicadores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>body { margin: 0; background: #f5f6fa; }</style>
</head>
<body>
  <div id="lp-container" style="min-height:100vh"></div>
  <script>
    async function loadLP() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      if (!id) {
        document.getElementById('lp-container').innerHTML = '<p>ID da LP n√£o informado.</p>';
        return;
      }
      try {
        // üîí CORRE√á√ÉO JWT: Incluir token de autentica√ß√£o
        const token = localStorage.getItem('clientToken') || localStorage.getItem('token');
        const headers = {};
        if (token) {
          headers['Authorization'] = `Bearer ${token}`;
        }
        
        const res = await fetch(`${window.location.hostname === "localhost" ? "http://localhost:3000/api" : "http://localhost:3000/api"}/lp-indicadores/${id}`, {
          headers: headers
        });
        const data = await res.json();
        if (!data.success || !data.data) throw new Error('LP n√£o encontrada');
        // Salva contexto no localStorage para o formul√°rio Hero funcionar
        localStorage.setItem('currentLpId', id);
        localStorage.setItem('currentLpName', data.data.name || '');
        localStorage.setItem('currentClientId', data.data.clientId);
        // Renderiza HTML salvo
        document.getElementById('lp-container').innerHTML = data.data.compiledOutput.html || '<p>LP sem conte√∫do.</p>';
        // Injeta CSS salvo, se houver
        if (data.data.compiledOutput.css) {
          const style = document.createElement('style');
          style.innerHTML = data.data.compiledOutput.css;
          document.head.appendChild(style);
        }
        // S√≥ chama o bind depois do JS p√∫blico estar carregado!
        setTimeout(() => {
          if (window.bindIndicadorForms) window.bindIndicadorForms();
        }, 100);
      } catch (err) {
        document.getElementById('lp-container').innerHTML = '<p>Erro ao carregar LP: ' + err.message + '</p>';
      }
    }
    loadLP();
  </script>
  <!-- IMPORTANTE: O JS p√∫blico deve ser importado DEPOIS do script acima -->
  <script src="../js/lp-indicador-form-public.js"></script>
</body>
</html> 
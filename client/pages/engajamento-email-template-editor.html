<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor de E-mail Marketing</title>
  <link rel="stylesheet" href="https://unpkg.com/grapesjs/dist/css/grapes.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="../css/tailwind.output.css">
  <style>
    body { background: #f5f6fa; margin: 0; padding: 15px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .editor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .editor-header h1 { font-size: 1.4rem; margin: 0; color: #2c3e50; font-weight: 600; }
    .editor-header .actions { display: flex; gap: 12px; align-items: center; }
    .btn { padding: 10px 20px; border-radius: 6px; border: none; font-weight: 500; cursor: pointer; font-size: 14px; transition: all 0.2s ease; }
    .btn-primary { background: #3498db; color: #fff; }
    .btn-primary:hover { background: #2980b9; }
    .btn-secondary { background: #95a5a6; color: #fff; }
    .btn-secondary:hover { background: #7f8c8d; }
    .btn-success { background: #27ae60; color: #fff; }
    .btn-success:hover { background: #229954; }
    .editor-row { display: flex; gap: 15px; height: calc(100vh - 140px); }
    .editor-canvas { flex: 1; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    #gjs { 
      height: 100%; 
      border: none; 
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    /* Forçar centralização do canvas */
    .gjs-cv-canvas {
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      min-height: 100vh !important;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      padding: 20px !important;
    }
    
    /* Forçar centralização do frame */
    .gjs-frame {
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      min-height: 100vh !important;
    }
    .panel__right {
      width: 320px;
      background: #222c36;
      border-radius: 8px;
      padding: 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .panel__tabs {
      display: flex;
      background: #fff;
      border-bottom: 2px solid #ecf0f1;
      flex-shrink: 0;
      box-shadow: 0 8px 4px rgba(0,0,0,0.05);
    }
    .panel__tab {
      flex: 1;
      padding: 10px 8px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 11px;
      font-weight: 700;
      color: #95a5a6;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
      position: relative;
      min-height: 70px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .panel__tab:hover {
      background: #f8f9fa;
      color: #2c3e50;
      transform: translateY(-1px);
    }
    .panel__tab.active {
      color: #3498db;
      background: #fff;
      border-bottom-color: #3498db;
      box-shadow: 0 -2px 8px rgba(52, 152, 219, 0.1);
    }
    .panel__tab[data-tab="blocks"].active {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      color: #2c3e50;
      border-bottom-color: #27ae60;
    }
    .panel__tab[data-tab="blocks"].active::before {
      background: #27ae60;
    }
    .panel__tab i {
      display: block;
      font-size: 18px;
      margin-bottom: 2px;
    }
    .panel__tab span {
      font-size: 10px;
      font-weight: 600;
    }
    .panel__content {
      flex: 1;
      overflow: hidden;
      position: relative;
    }
    .panel__tab-content {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .panel__tab-content.active {
      opacity: 1;
      visibility: visible;
    }
    .blocks-container {
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 12px !important;
      padding: 15px;
      background: none;
    }
    .gjs-block {
      width: 100% !important;
      height: auto !important;
      min-height: 44px !important;
      margin: 0 0 8px 0 !important;
      padding: 12px 20px !important;
      background: #ffffff !important;
      border: 1px solid #ecf0f1 !important;
      border-radius: 7px !important;
      cursor: grab !important;
      transition: all 0.2s ease !important;
      display: flex !important;
      align-items: center !important;
      font-size: 14px !important;
      color: #2c3e50 !important;
      font-weight: 500 !important;
      justify-content: space-between !important;
      justify-content: center !important;
    }
    .gjs-block:hover {
      background: #f8f9fa !important;
      border-color: #3498db !important;
      transform: translateX(2px) !important;
      box-shadow: 0 2px 8px rgba(52, 152, 219, 0.15) !important;
    }
    .gjs-block:active {
      cursor: grabbing !important;
    }
    .gjs-block i { font-size: 24px; color: #7f8c8d; margin-bottom: 8px; display: block; }
    .gjs-block-label { font-size: 12px; color: #2c3e50; font-weight: 500; margin-top: 6px; }
    .template-info { background: #e8f5e8; border: 1px solid #27ae60; border-radius: 6px; padding: 15px; margin-bottom: 15px; }
    .template-info h3 { margin: 0 0 10px 0; color: #27ae60; font-size: 14px; font-weight: 600; }
    .template-info p { margin: 5px 0; font-size: 12px; color: #2c3e50; }
    .variable-tag { background: #3498db; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-family: monospace; }
    .blocks-container .gjs-block {
      width: auto !important;
      min-width: 120px !important;
      max-width: 100% !important;
      display: flex !important;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0 !important;
      float: none !important;
      position: static !important;
      clear: none !important;
      box-sizing: border-box !important;
    }
    .blocks-container .gjs-block * {
      width: auto !important;
      max-width: 100% !important;
    }
    .blocks-container {
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 16px !important;
    }
    .editor-sidebar .blocks-container .gjs-block {
      width: auto !important;
      max-width: 100% !important;
      min-width: 120px !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      margin: 0 !important;
    }
    @media (max-width: 900px) {
      .editor-sidebar { width: 100vw; max-width: 98vw; min-width: 0; }
      .blocks-container { grid-template-columns: 1fr; }
    }
    .blocks-container {
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 16px !important;
      padding: 15px;
      background: #393e46 !important;
      width: 95%;
      max-width: 95%;
      margin: 0 auto;
      border-radius: 12px;
      box-sizing: border-box;
    }
    .gjs-category {
      width: 100% !important;
      max-width: 100% !important;
      margin: 0 auto 18px auto !important;
      background: #444444 !important;
      border-radius: 1200px !important;
      box-sizing: border-box !important;
    }
    .gjs-category .gjs-blocks-c {
      width: 100% !important;
      max-width: 100% !important;
      box-sizing: border-box !important;
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 12px !important;
      margin: 0 !important;
      padding: 0 12px 12px 12px !important;
    }
    .gjs-category .gjs-block {
      display: flex !important;
      flex-direction: row !important; /* ou remova esta linha */
      align-items: center !important;
      justify-content: center !important;
      width: 100% !important;
      min-width: 0 !important;
      max-width: 100% !important;
      min-height: 70px !important;
      height: 70px !important;
      box-sizing: border-box !important;
      padding: 8px 8px !important;
      gap: 4px !important;
      text-align: center !important;
      white-space: normal !important;
    }
    .gjs-category .gjs-block i,
    .gjs-category .gjs-block .gjs-block-label {
      width: 100% !important;
      text-align: center !important;
      display: block !important;
      margin: 0 auto !important;
    }
    .gjs-category,
    .gjs-category .gjs-blocks-c,
    .gjs-category .gjs-block {
      all: unset;
      box-sizing: border-box !important;
    }
    .gjs-category {
      width: 99% !important;
      max-width: 99% !important;
      margin: 0 auto 18px auto !important;
      background: #444444 !important;
      border-radius: 12px !important;
      padding: 8px 0 16px 0 !important;
      box-sizing: border-box !important;
    }
    .gjs-category .gjs-blocks-c {
      width: 100% !important;
      max-width: 100% !important;
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 12px !important;
      margin: 0 !important;
      padding: 0 12px 12px 12px !important;
      box-sizing: border-box !important;
    }
    .gjs-category .gjs-block {
      width: 100% !important;
      min-width: 0 !important;
      max-width: 100% !important;
      min-height: 70px !important;
      height: 70px !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      box-sizing: border-box !important;
      padding: 8px 8px !important;
      gap: 4px !important;
      text-align: center !important;
      white-space: normal !important;
    }
    .gjs-category .gjs-block i,
    .gjs-category .gjs-block .gjs-block-label {
      width: 100% !important;
      text-align: center !important;
      display: block !important;
      margin: 0 auto !important;
    }
    .gjs-blocks-container,
    .gjs-category,
    .gjs-blocks-c {
      width: 100% !important;
      max-width: 100% !important;
      min-width: 0 !important;
      box-sizing: border-box !important;
      overflow: visible !important;
    }

    .gjs-category .gjs-blocks-c {
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 12px !important;
      margin: 0 !important;
      padding: 0 8px 8px 8px !important;
    }

    .gjs-category .gjs-block {
      width: 100% !important;
      min-width: 0 !important;
      max-width: 100% !important;
      min-height: 70px !important;
      height: 70px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      box-sizing: border-box !important;
      padding: 8px 8px !important;
      text-align: center !important;
    }
    /* Blocos - GRID 2 colunas e alinhamento */
    .gjs-category {
      width: 99% !important;
      max-width: 99% !important;
      margin: 0 auto 18px auto !important;
      background: #444444 !important;
      border-radius: 12px !important;
      padding: 8px 0 16px 0 !important;
      box-sizing: border-box !important;
    }
    .gjs-category .gjs-blocks-c {
      width: 100% !important;
      max-width: 100% !important;
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 12px !important;
      margin: 0 !important;
      padding: 0 8px 8px 8px !important;
      box-sizing: border-box !important;
    }
    .gjs-category .gjs-block {
      width: 100% !important;
      min-width: 0 !important;
      max-width: 100% !important;
      min-height: 70px !important;
      height: 70px !important;
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      box-sizing: border-box !important;
      padding: 8px 8px !important;
      gap: 4px !important;
      text-align: center !important;
      white-space: normal !important;
      background: #fff !important;
      border: 1px solid #ecf0f1 !important;
      border-radius: 7px !important;
      font-size: 14px !important;
      color: #2c3e50 !important;
      font-weight: 500 !important;
      cursor: grab !important;
      transition: all 0.2s ease !important;
    }
    .gjs-category .gjs-block i,
    .gjs-category .gjs-block .gjs-block-label {
      width: 100% !important;
      text-align: center !important;
      display: block !important;
      margin: 0 auto !important;
    }
    .gjs-block:hover {
      background: #f8f9fa !important;
      border-color: #3498db !important;
      transform: translateX(2px) !important;
      box-shadow: 0 2px 8px rgba(52, 152, 219, 0.15) !important;
    }
    .gjs-block:active {
      cursor: grabbing !important;
    }
    @media (max-width: 900px) {
      .gjs-category .gjs-blocks-c { grid-template-columns: 1fr !important; }
    }
  </style>
</head>
<body>
  <div class="editor-header">
    <div>
      <h1 id="editorTitle">
        <i class="fas fa-envelope mr-2 text-blue-500"></i>
        Editor de E-mail Marketing
      </h1>
      <div class="mt-2 flex gap-4">
        <div class="flex-1">
          <label for="templateName" class="block text-xs font-semibold text-gray-600 mb-1">Nome do Template</label>
          <input id="templateName" type="text" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Digite o nome do template" />
        </div>
        <div class="flex-1">
          <label for="templateType" class="block text-xs font-semibold text-gray-600 mb-1">Tipo do Template</label>
          <select id="templateType" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400">
            <option value="welcome">E-mail de Boas-vindas</option>
            <option value="campaign">E-mail de Campanha</option>
            <option value="flow">E-mail de Fluxo</option>
            <option value="notification">E-mail de Notificação</option>
          </select>
        </div>
      </div>
      <p id="templateDescription" class="text-sm text-gray-600 mt-1">Configurando template de e-mail marketing</p>
    </div>
    <div class="actions">
      <button class="btn btn-secondary" onclick="previewEmail()">
        <i class="fas fa-eye mr-2"></i>Visualizar
      </button>
      <button class="btn btn-primary" onclick="saveTemplate()">
        <i class="fas fa-save mr-2"></i>Salvar Template
      </button>
      <button class="btn btn-success" onclick="testEmail()">
        <i class="fas fa-paper-plane mr-2"></i>Testar E-mail
      </button>
    </div>
  </div>
  <div class="editor-row">
    <div class="editor-canvas">
      <div id="gjs"></div>
    </div>
    <div class="panel__right">
      <div class="panel__header">
        <i class="fas fa-tools mr-2"></i>Ferramentas do Editor
      </div>
      <div class="panel__tabs">
        <div class="panel__tab active" id="tab-btn-blocks" onclick="switchTab('blocks')">
          <i class="fas fa-cubes mr-1"></i>Blocos
        </div>
        <div class="panel__tab" id="tab-btn-styles" onclick="switchTab('styles')">
          <i class="fas fa-palette mr-1"></i>Estilos
        </div>
        <div class="panel__tab" id="tab-btn-variaveis" onclick="switchTab('variaveis')">
          <i class="fas fa-code mr-1"></i>Variáveis
        </div>
      </div>
      <div class="panel__content">
        <div class="panel__tab-content active" id="tab-blocks">
          <div class="blocks-container" id="blocks"></div>
        </div>
        <div class="panel__tab-content" id="tab-styles">
          <div class="styles-container"></div>
        </div>
        <div class="panel__tab-content" id="tab-variaveis">
          <div style="padding: 18px 18px 8px 18px;">
            <h3 style="margin: 0 0 10px 0; color: #27ae60; font-size: 15px; font-weight: 600; display: flex; align-items: center;"><i class='fas fa-info-circle mr-1'></i> Variáveis Disponíveis</h3>
            <div id="variaveis-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/grapesjs"></script>
  <script src="../js/config.js"></script>
  <script src="../js/engajamento-email-template-editor.js"></script>
  <script>
function forceBlocksGrid() {
  document.querySelectorAll('.gjs-blocks-c').forEach(el => {
    el.style.display = 'grid';
    el.style.gridTemplateColumns = '1fr 1fr';
    el.style.gap = '12px';
    el.style.width = '100%';
    el.style.maxWidth = '100%';
    el.style.minWidth = '0';
    el.style.boxSizing = 'border-box';
    el.style.margin = '0';
    el.style.padding = '0 8px 8px 8px';
  });
}
setTimeout(forceBlocksGrid, 1000);
setTimeout(forceBlocksGrid, 2000);
setTimeout(forceBlocksGrid, 3000);
document.addEventListener('DOMContentLoaded', forceBlocksGrid);
  </script>
  <script>
    // Atualizar função switchTab para incluir variáveis
    function switchTab(tabName) {
      document.querySelectorAll('.panel__tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.panel__tab-content').forEach(content => content.classList.remove('active'));
      document.getElementById('tab-btn-' + tabName).classList.add('active');
      document.getElementById('tab-' + tabName).classList.add('active');
    }
    
    // Função para garantir centralização
    function ensureCentralization() {
      const canvas = document.querySelector('.gjs-cv-canvas');
      const frame = document.querySelector('.gjs-frame');
      
      if (canvas) {
        canvas.style.display = 'flex';
        canvas.style.alignItems = 'center';
        canvas.style.justifyContent = 'center';
        canvas.style.minHeight = '100vh';
        canvas.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        canvas.style.padding = '20px';
      }
      
      if (frame) {
        frame.style.display = 'flex';
        frame.style.alignItems = 'center';
        frame.style.justifyContent = 'center';
        frame.style.minHeight = '100vh';
      }
    }
    
    // Aplicar centralização periodicamente
    setInterval(ensureCentralization, 1000);
    
    // Aplicar centralização quando a página carregar
    document.addEventListener('DOMContentLoaded', ensureCentralization);
    // Lista de variáveis disponíveis
    const variaveis = [
      { tag: '{{nome}}', desc: 'Nome do indicador' },
      { tag: '{{email}}', desc: 'E-mail do indicador' },
      { tag: '{{linkIndicacao}}', desc: 'Link exclusivo de indicação' },
      { tag: '{{campanha}}', desc: 'Nome da campanha' },
      { tag: '{{empresa}}', desc: 'Nome da empresa' },
      { tag: '{{senha}}', desc: 'Senha de acesso do indicador' },
      { tag: '{{linkAcesso}}', desc: 'Link para área exclusiva' },
      { tag: '{{dataCriacao}}', desc: 'Data de criação' },
      { tag: '{{nomeResponsavel}}', desc: 'Nome do responsável' },
      { tag: '{{telefone}}', desc: 'Telefone de contato' },
    ];
    // Renderizar variáveis como blocos arrastáveis
    function renderVariaveis() {
      const list = document.getElementById('variaveis-list');
      list.innerHTML = '';
      variaveis.forEach(v => {
        const bloco = document.createElement('div');
        bloco.className = 'gjs-block';
        bloco.setAttribute('draggable', 'true');
        bloco.setAttribute('data-var', v.tag);
        bloco.innerHTML = `<span class='variable-tag' style='font-size:13px;'>${v.tag}</span><span class='gjs-block-label' style='font-size:12px; color:#2c3e50; margin-top:4px;'>${v.desc}</span>`;
        bloco.ondragstart = function(e) {
          e.dataTransfer.setData('text/plain', v.tag);
          e.dataTransfer.effectAllowed = 'copy';
        };
        list.appendChild(bloco);
      });
    }
    renderVariaveis();
    // Integração com GrapesJS: inserir variável no drop
    document.addEventListener('DOMContentLoaded', function() {
      const iframe = document.querySelector('#gjs iframe');
      function setupDrop() {
        if (!iframe || !iframe.contentDocument) return;
        iframe.contentDocument.addEventListener('dragover', function(e) {
          e.preventDefault();
        });
        iframe.contentDocument.addEventListener('drop', function(e) {
          e.preventDefault();
          const txt = e.dataTransfer.getData('text/plain');
          const sel = iframe.contentWindow.getSelection();
          if (sel && sel.rangeCount > 0) {
            sel.getRangeAt(0).insertNode(iframe.contentDocument.createTextNode(txt));
          }
        });
      }
      setTimeout(setupDrop, 1500);
    });
  </script>
</body>
</html>